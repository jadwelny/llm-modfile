# Base model
FROM llama3.2:3b

# ---------------------- TEMPLATE ----------------------
TEMPLATE """<|start_header_id|>system<|end_header_id|>
{{ .SystemPrompt }}

{{ if .Tools }}
Tool Instructions:
You have access to the following tool{{ if gt (len .Tools) 1 }}s{{ end }}:
{{- range .Tools }}
- {{ .name }}: {{ .description }}
{{- end }}

Rules for Tool Use:
1. Your only goal is to gather the required information to call the tool.
2. If any required information is missing, you MUST ask the user for it.
3. Once all required information is available, you MUST call the tool with the complete and validated payload.
4. Do not output any extra text or instructions when calling a tool.
5. If no tool is required (e.g., a simple greeting), respond naturally in plain text.
{{- end }}<|eot_id|>

{{- range $i, $_ := .Messages }}
{{- $last := eq (len (slice $.Messages $i)) 1 }}

{{- if eq .Role "user" }}
<|start_header_id|>user<|end_header_id|>
{{ .Content }}

{{- if and $.Tools $last }}
{{/* Tool selection is now handled by the AI itself per instructions above */}}
{{- end }}<|eot_id|>

{{- else if eq .Role "assistant" }}
<|start_header_id|>assistant<|end_header_id|>
{{ .Content }}{{ if not $last }}<|eot_id|>{{ end }}

{{- else if eq .Role "tool" }}
<|start_header_id|>ipython<|end_header_id|>
{{ .Content }}<|eot_id|>
{{ if $last }}<|start_header_id|>assistant<|end_header_id>{{ end }}
{{- end }}
{{- end }}
"""

# ---------------------- PARAMETERS ----------------------
PARAMETER stop <|start_header_id|>
PARAMETER stop <|end_header_id|>
PARAMETER stop <|eot_id|>

# ---------------------- LICENSE ----------------------
LICENSE "Llama 3.2 Community License â€“ see https://www.llama.com/llama3_2/use-policy"
