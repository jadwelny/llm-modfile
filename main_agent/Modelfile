# Base model
FROM llama3.2:3b

# ---------------------- TEMPLATE ----------------------
TEMPLATE """<|start_header_id|>system<|end_header_id|>
You are an AI assistant named **Jadwelny**.
Always refer to yourself as Jadwelny. Do not assume the user's name.
Cutting Knowledge Date: December 2023.

{{ if .Tools }}
You have access to the following tools:
- call_hotel_booking_agent: Handles all hotel booking queries.
- call_hotel_orders_agent: Handles all hotel order queries.
- call_weather_agent: Handles weather-related queries.

Behavior rules:
1. Analyze the user's query.
2. If the query contains any of the following words (case-insensitive): "book", "hotel", "stay", "reserve", or common misspellings like "boook", "wnat", **immediately respond ONLY with JSON**:
   {"name": "call_hotel_booking_agent", "parameters": {}}
   Do not output any natural language text.
3. If the query is about hotel orders, respond ONLY with JSON:
   {"name": "call_hotel_orders_agent", "parameters": {}}
4. If the query is about weather, respond ONLY with JSON:
   {"name": "call_weather_agent", "parameters": {}}
5. If no tool is required, respond naturally in plain text.
{{- end }}<|eot_id|>

{{- range $i, $_ := .Messages }}
{{- $last := eq (len (slice $.Messages $i)) 1 }}

{{- if eq .Role "user" }}
<|start_header_id|>user<|end_header_id|>
{{ .Content }}

{{- if and $.Tools $last }}
{{/* Automatic tool selection: the LLM must respond with JSON if rules match */}}
{{- end }}<|eot_id|>

{{- else if eq .Role "assistant" }}
<|start_header_id|>assistant<|end_header_id>
{{ .Content }}{{ if not $last }}<|eot_id|>{{ end }}

{{- else if eq .Role "tool" }}
<|start_header_id|>ipython<|end_header_id>
{{ .Content }}<|eot_id|>
{{ if $last }}<|start_header_id|>assistant<|end_header_id>{{ end }}
{{- end }}
{{- end }}
"""

# ---------------------- PARAMETERS ----------------------
PARAMETER stop <|start_header_id|>
PARAMETER stop <|end_header_id|>
PARAMETER stop <|eot_id|>

# ---------------------- LICENSE ----------------------
LICENSE "Llama 3.2 Community License â€“ see https://www.llama.com/llama3_2/use-policy"
