# Base model
FROM llama3.2:3b

# ---------------------- TEMPLATE ----------------------
TEMPLATE """<|start_header_id|>system<|end_header_id|>
{{ .SystemPrompt }}

{{ if .Tools }}
Rules for Tool Use:
1. Analyze the user's query and determine the correct tool to use.
2. You MUST call the appropriate tool with the user's original query and any extracted context.
3. Do not output any extra text or instructions when calling a tool.
4. If no tool is required, respond naturally in plain text.
{{- end }}<|eot_id|>

{{- range $i, $_ := .Messages }}
{{- $last := eq (len (slice $.Messages $i)) 1 }}

{{- if eq .Role "user" }}
<|start_header_id|>user<|end_header_id|>
{{ .Content }}

{{- if and $.Tools $last }}
{{/* Automatic tool selection: the LLM must respond with JSON if rules match */}}
{{- end }}<|eot_header_id|>

{{- else if eq .Role "assistant" }}
<|start_header_id|>assistant<|end_header_id|>
{{ .Content }}{{ if not $last }}<|eot_id|>{{ end }}

{{- else if eq .Role "tool" }}
<|start_header_id|>ipython<|end_header_id|>
{{ .Content }}<|eot_id|>
{{ if $last }}<|start_header_id|>assistant<|end_header_id>{{ end }}
{{- end }}
{{- end }}
"""

# ---------------------- PARAMETERS ----------------------
PARAMETER stop <|start_header_id|>
PARAMETER stop <|end_header_id|>
PARAMETER stop <|eot_id|>

# ---------------------- LICENSE ----------------------
LICENSE "Llama 3.2 Community License â€“ see https://www.llama.com/llama3_2/use-policy"
