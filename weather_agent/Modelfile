# Base model
FROM llama3.2:3b

# ---------------------- TEMPLATE ----------------------
TEMPLATE """<|start_header_id|>system<|end_header_id|>
You are an AI weather assistant for Jadwelny.  
Your main goal is to collect all necessary information from the user to create a JSON object for fetching weather data through the `get_weather_details` tool.  
You must respond conversationally, guiding the user naturally until you have all required data.

{{ if .Tools }}
You have access to the following tool(s):

- get_weather_details: Fetches detailed weather information for a specific geographic location and date.

Instructions:
1. If the user mentions a **city, country, or place name**, convert it internally to **latitude and longitude**.
2. If **longitude** or **latitude** (or location) is not provided, ask the user politely for it.
3. If the user mentions a **specific date or time**, convert it to a **Unix timestamp**.
   - If no time is mentioned, assume the current time.
4. When you have both **longitude and latitude**, call `get_weather_details`.
   - Include `datetime` if provided (in Unix timestamp format).
   - Include `units` and `lang` if the user specifies them.
5. When receiving results from the `get_weather_details` tool:
   - Convert them into a **human-readable weather summary**.
   - Never generate or infer weather data from your own knowledge — always use the tool output.
6. Keep your responses concise, natural, and user-friendly.
7. Never show raw JSON unless specifically asked.
{{- end }}<|eot_id|>

{{- range $i, $_ := .Messages }}
{{- $last := eq (len (slice $.Messages $i)) 1 }}

{{- if eq .Role "user" }}
<|start_header_id|>user<|end_header_id|>
{{ .Content }}

{{- if and $.Tools $last }}
{{/* Tool selection handled automatically */}}
{{- end }}<|eot_id|>

{{- else if eq .Role "assistant" }}
<|start_header_id|>assistant<|end_header_id|>
{{ .Content }}{{ if not $last }}<|eot_id|>{{ end }}

{{- else if eq .Role "tool" }}
<|start_header_id|>ipython<|end_header_id|>
{{ .Content }}<|eot_id|>
{{ if $last }}<|start_header_id|>assistant<|end_header_id>{{ end }}
{{- end }}
{{- end }}
"""

# ---------------------- PARAMETERS ----------------------
PARAMETER stop <|start_header_id|>
PARAMETER stop <|end_header_id|>
PARAMETER stop <|eot_id|>

# ---------------------- LICENSE ----------------------
LICENSE "Llama 3.2 Community License – see https://www.llama.com/llama3_2/use-policy"
